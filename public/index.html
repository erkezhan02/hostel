<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –û—Ç–µ–ª–µ–π</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–µ–ª—å</h2>
<input type="text" id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–µ–ª—è">
<input type="text" id="location" placeholder="–ì–æ—Ä–æ–¥">
<input type="number" id="rating" placeholder="–†–µ–π—Ç–∏–Ω–≥ (1-5)">
<input type="text" id="amenities" placeholder="–£–¥–æ–±—Å—Ç–≤–∞ (Wi-Fi, –ë–∞—Å—Å–µ–π–Ω)">
<button onclick="addHotel()">–î–æ–±–∞–≤–∏—Ç—å</button>

<h2>–û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–µ–ª—å</h2>
<input type="text" id="update-id" placeholder="ID –æ—Ç–µ–ª—è" readonly>
<input type="text" id="update-name" placeholder="–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
<input type="text" id="update-location" placeholder="–ù–æ–≤—ã–π –≥–æ—Ä–æ–¥">
<input type="number" id="update-rating" placeholder="–ù–æ–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥ (1-5)">
<input type="text" id="update-amenities" placeholder="–ù–æ–≤—ã–µ —É–¥–æ–±—Å—Ç–≤–∞">
<button onclick="updateHotel()">–û–±–Ω–æ–≤–∏—Ç—å</button>

<h2>–°–ø–∏—Å–æ–∫ –æ—Ç–µ–ª–µ–π</h2>
<button onclick="getHotels()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç–µ–ª–∏</button>
<div class="hotels"></div>

<h2>–ü–æ–∏—Å–∫ –æ—Ç–µ–ª–µ–π –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É</h2>
<div>
    <input type="number" id="min-rating" placeholder="–ú–∏–Ω. —Ä–µ–π—Ç–∏–Ω–≥ (1-5)" min="1" max="5">
    <input type="number" id="max-rating" placeholder="–ú–∞–∫—Å. —Ä–µ–π—Ç–∏–Ω–≥ (1-5)" min="1" max="5">
    <button onclick="searchHotelsByRating()">–ù–∞–π—Ç–∏ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É</button>
</div>
<div id="rating-results" class="hotels"></div>



<script>
    const API_URL = "http://localhost:5000/hotels";
    const SEARCH_URL = "http://localhost:5000/hotels/search";


    function getHotels() {
        fetch(API_URL)
            .then(res => res.json())
            .then(data => {
                const hotelsContainer = document.querySelector(".hotels");
                let html = "";
                data.forEach(hotel => {
                    html += `
                    <div class="hotel-card">
                        <h3>${hotel.name}</h3>
                        <p><b>–ì–æ—Ä–æ–¥:</b> ${hotel.location}</p>
                        <p><b>–†–µ–π—Ç–∏–Ω–≥:</b> ${hotel.rating}‚òÖ</p>
                        <p><b>–£–¥–æ–±—Å—Ç–≤–∞:</b> ${hotel.amenities.join(", ")}</p>
                        <button class="edit-btn" onclick="fillUpdateForm('${hotel._id}', '${hotel.name}', '${hotel.location}', '${hotel.rating}', '${hotel.amenities.join(", ")}')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="delete-btn" onclick="deleteHotel('${hotel._id}')">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>`;
                });
                hotelsContainer.innerHTML = html;
            })
            .catch(err => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–µ–ª–µ–π:", err);
            });
    }

    function addHotel() {
        const name = document.getElementById("name").value;
        const location = document.getElementById("location").value;
        const rating = document.getElementById("rating").value;
        const amenities = document.getElementById("amenities").value.split(",");

        fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, location, rating, amenities })
        }).then(() => getHotels());
    }

    function updateHotel() {
        const id = document.getElementById("update-id").value;
        const name = document.getElementById("update-name").value;
        const location = document.getElementById("update-location").value;
        const rating = document.getElementById("update-rating").value;
        const amenities = document.getElementById("update-amenities").value.split(",");

        fetch(`${API_URL}/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, location, rating, amenities })
        }).then(() => getHotels());
    }

    function fillUpdateForm(id, name, location, rating, amenities) {
        document.getElementById("update-id").value = id;
        document.getElementById("update-name").value = name;
        document.getElementById("update-location").value = location;
        document.getElementById("update-rating").value = rating;
        document.getElementById("update-amenities").value = amenities;
    }

    function deleteHotel(id) {
        fetch(`${API_URL}/${id}`, { method: "DELETE" })
            .then(() => getHotels());
    }

    function searchHotelsByRating() {
        const minRating = parseFloat(document.getElementById("min-rating").value) || 1;
        const maxRating = parseFloat(document.getElementById("max-rating").value) || 5;
        const resultsContainer = document.getElementById("rating-results");

        fetch(`${SEARCH_URL}?minRating=${minRating}&maxRating=${maxRating}`)
            .then(res => res.json())
            .then(data => {
                let html = "";
                if (data.length > 0) {
                    data.forEach(group => {
                        group.hotels.forEach(hotel => {
                            html += `
                            <div class="hotel-card">
                                <h3>${hotel.name}</h3>
                                <p><b>–ì–æ—Ä–æ–¥:</b> ${hotel.location}</p>
                                <p><b>–†–µ–π—Ç–∏–Ω–≥:</b> ${hotel.rating}‚òÖ</p>
                                <p><b>–£–¥–æ–±—Å—Ç–≤–∞:</b> ${hotel.amenities ? hotel.amenities.join(", ") : ''}</p>
                                <button class="edit-btn" onclick="fillUpdateForm('${hotel._id}', '${hotel.name}', '${hotel.location}', '${hotel.rating}', '${hotel.amenities ? hotel.amenities.join(", ") : ''}')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button class="delete-btn" onclick="deleteHotel('${hotel._id}')">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>`;
                        });
                    });
                } else {
                    html = `<p>üòî –û—Ç–µ–ª–µ–π —Å —Ç–∞–∫–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>`;
                }

                resultsContainer.innerHTML = html;
            })
            .catch(err => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –æ—Ç–µ–ª–µ–π –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É:", err);
                resultsContainer.innerHTML = "<p>üö´ –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–æ–∏—Å–∫–∞.</p>";
            });
    }

</script>

</body>
</html>
